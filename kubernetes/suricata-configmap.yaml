apiVersion: v1
kind: ConfigMap
metadata:
  name: suricata-config
data:
  suricata.yaml: |
    %YAML 1.1
    ---
    # Minimalny/szablonowy plik konfiguracyjny Suricata dla trybu NFQUEUE (IPS)
    defaults:
      run-as:
        user: suricata
        group: suricata

    af-packet:
      - interface: eth0

    nfq:
      - id: 0
        threads: 4
        # max_length można dostosować
        max_length: 65535

    outputs:
      - eve-log:
          enabled: yes
          filetype: regular
          filename: /var/log/suricata/eve.json
          types:
            - alert:
                payload: yes
                payload-printable: no
                packet: yes
            - http
            - tls
            - dns
      - syslog:
          enabled: yes
          facility: local5

    logging:
      default-log-level: info
      outputs:
        - console:
            enabled: yes

    rule-files:
      - local.rules

    detection:
      enabled: yes

  local.rules: |
    # Prosty test rule: wykrywa wiele nieudanych prób logowania HTTP (przykład)
    alert http any any -> any any (msg:"HTTP brute force attempt"; flow:established,to_server; content:"/login"; http_method; threshold: type both, track by_src, count 10, seconds 60; sid:1000001; rev:1;)
